#!/bin/sh

# Get current volume and mute state
VOL_INFO=$(amixer -D pulse get Master)
VOL=$(echo "$VOL_INFO" | grep -o "[0-9]*%" | head -1 | tr -d '%')
MUTE=$(echo "$VOL_INFO" | grep -o '\[off\]' | head -1)

# Choose icon
if [ -n "$MUTE" ]; then
    ICON=" "   # muted
elif [ "$VOL" -lt 33 ]; then
    ICON=" "   # low volume
elif [ "$VOL" -lt 66 ]; then
    ICON=" "   # medium volume
else
    ICON=" "   # high volume
fi

# Output for dwmblocks
echo "$ICON${VOL}%"

# Handle mouse/scroll input
case $BLOCK_BUTTON in
    1) setsid -f "$TERMINAL" -e pulsemixer ;;
    2) amixer -D pulse set Master toggle; pkill -RTMIN+12 "${STATUSBAR:-dwmblocks}" ;;
    3) setsid -f "$TERMINAL" -e "$EDITOR" "$0" ;;
    4) amixer -D pulse sset Master 5%+; pkill -RTMIN+12 "${STATUSBAR:-dwmblocks}" ;;
    5) amixer -D pulse sset Master 5%-; pkill -RTMIN+12 "${STATUSBAR:-dwmblocks}" ;;
esac
